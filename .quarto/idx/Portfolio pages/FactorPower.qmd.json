{"title":"Factorial Anova and Power Analysis in R","markdown":{"yaml":{"title":"Factorial Anova and Power Analysis in R","editor":"visual","author":"Matthew Swanson","categories":["Factorial ANOVA","R","Power Analysis","Effect Size","Clinical Trial Data"],"warning":false,"message":false},"headingText":"**Project Goal**","containsRefs":false,"markdown":"\n\n::: text-center\n:::\n\nIt is of interest to a client to analyze data from a clinical trial on tooth growth. It is of particular interest to ascertain how different dosage amounts and types of supplements influence tooth growth. First, I will need to load the data set and calculate data descriptives and run some ANOVAs.\n\nLoading the data:\n\n```{r}\ndata(\"ToothGrowth\")\nhead(ToothGrowth)\n```\n\nNeed cell means and variances next.\n\n```{r}\nlibrary(dplyr)\nToothGrowth %>%\ngroup_by(supp, dose)%>%\nsummarize(group_mean = mean(len), n = n(), var = var(len)) \n```\n\n::: text-center\n# **Factorial ANOVA**\n:::\n\nGlancing at these cell means indicates a potential pattern. Namely, that across supplement, as dosage increases, tooth length increases. It also appears that across dosage, the OJ supplement produces longer teeth growth than the VC supplement. However, to determine if these mean differences are significant, I need to conduct a factorial ANOVA.\n\n```{r}\n#Need to ensure that R reads factor variables as factors first\n\nToothGrowth$supp <- as.factor(ToothGrowth$supp)\nToothGrowth$dose <- as.factor(ToothGrowth$dose)\nFactorANOVA <- aov(len ~ dose*supp, ToothGrowth) #you can also just add in dose*supp and R understands to include the interaction and both main effects in the model - nice way to shorten code\n\nsummary(FactorANOVA)\n\n#Calculating Marginal Means\n\nlibrary(emmeans)\n\nCondition_Means <- emmeans(FactorANOVA, ~ supp*dose)\nCondition_Means\n\nMarginal_MeansSupp <- emmeans(FactorANOVA, ~ supp)\nMarginal_MeansSupp\n\nMarginal_MeansDose <- emmeans(FactorANOVA, ~ dose)\nMarginal_MeansDose\n```\n\nA quick glance at the output highlights that both the main effects of dose and supplement are significant as well as their interaction. Across supplement type, the means of tooth length were significantly different among three dosage conditions: 0.5 dosage (M = 10.61), 1.0 dosage (M = 19.74), and 2.0 dosage (M = 26.10), F(2,54) = 92.00, p \\<.001. There was also a statistically significant difference in the average tooth length between supplement type, across dosage: OJ (M = 20.66) and VC condition (M = 16.96), F(1,54) = 15.57, p \\<.001. The interaction between dosage amount and supplement type was significant, F(2,54) = 4.11, p =.02.\n\n::: text-center\n## **Simple Effects**\n:::\n\nGiven the significant interaction, I know that the effects of one variable depends on the levels of the other variable. One way to understand this effect is to look at the simple effects.\n\n```{r}\nlibrary(phia)\n\nlm1 <- lm(len ~ dose*supp, ToothGrowth)\n\nTest1 <- testInteractions(lm1, fixed = \"dose\", across = \"supp\")\nTest1\n\nTest2 <- testInteractions(lm1, fixed = \"supp\", across = \"dose\")\nTest2\n\ncontrast(Condition_Means, \"revpairwise\", by= \"dose\", adjust = \"none\")\n```\n\nNote here the significance levels: for example, the effects of supplement within 0.5 & 1.0 dosage levels are significant. Additionally, the effects of dosage within OJ and VC supplement are also significant. Looking at the contrast estimates, it becomes clear that For both dosage levels of 0.5 and 1.0, teeth grow significantly less when the patient is also provided a vitamin C supplement, compared to the teeth of patients provided an orange juice supplement, t(54) = -3.23, p =.002 and t(54) = -3.65, p \\<.001 respectively.\n\n::: text-center\n## **Effect Sizes**\n:::\n\nNow let's collect both biased and unbiased estimates of effect size for our three effects in this model. This will help clarify the magnitude of effect of both dosage and supplement type.\n\n```{r}\nlibrary(lsr)\nlibrary(effectsize)\n\nEta <- etaSquared(FactorANOVA, type = 2, anova = TRUE)\nEta\n\nomega_squared(FactorANOVA, partial = FALSE, ci = 0.95)\nomega_squared(FactorANOVA, partial = TRUE, ci = 0.95)\n```\n\nThe eta squared value associated with the interaction between dosage and supplement is .03. In other words, the interaction term explains approximately 3% of the variance in tooth length. Its' respective partial eta squared value is .13, indicating that the interaction term explains about 13% of the unique variance in tooth length, accounting for any shared variance with dosage and supplement. The interaction term's omega squared and partial omega squared values are slightly smaller as these effect sizes have been corrected for bias but the interpretation stays the same.\n\n::: text-center\n# **Power Analysis**\n:::\n\nNow, I will calculate power for this analysis.\n\n```{r}\nlibrary(pwr)\n\nf <- sqrt(0.031376 / (1-0.031376))\npwr.anova.test(k = 6, n = 10, f = f, sig.level = .95)\n```\n\nI have about a 98% power level to detect the interaction effect in our data, should the effect truly exist. What about the main effect of supplement?\n\n```{r}\nf <- sqrt(0.05948365 / (1-0.05948365))\npwr.anova.test(k = 2, n = 30, f = f, sig.level = .95)\n```\n\nI have a 99% power level to detect the effect of supplement, should the effect exist.\n\n::: text-center\n# **Visualizations**\n:::\n\nThe client also requested some visualizations, so I will create a bar and line graph of the above group means.\n\n```{r}\nlibrary(ggplot2)\n\nggplot(ToothGrowth, aes(x =as.factor(dose), y = len, fill = as.factor(supp))) + \n  stat_summary(fun='mean',geom='bar', position = \"dodge\") +\n  labs(x = \"Dosage\", y = \"Tooth Length\", fill = \"Supplement Type\", title = \"Figure 1\", subtitle = \"Mean Tooth Length Scores by Dosage and Supplement\")+\n  theme(plot.title = element_text(face = \"bold\"),\n        plot.subtitle = element_text(face = \"italic\")) +\n  scale_fill_manual(values = c(\"#D71920\", \"#002266\"))\n\ninteraction.plot(x.factor = ToothGrowth$dose, #x-axis variable\n                 trace.factor = ToothGrowth$supp, #variable for lines\n                 response = ToothGrowth$len, #y-axis variable\n                 fun = mean, #metric to plot\n                 ylab = \"Tooth Length\",\n                 xlab = \"Dosage\",\n                 col = c(\"pink\", \"blue\"),\n                 lty = 1, #line type\n                 lwd = 2, #line width\n                 trace.label = \"Supplement Type\")\n```\n","srcMarkdownNoYaml":"\n\n::: text-center\n# **Project Goal**\n:::\n\nIt is of interest to a client to analyze data from a clinical trial on tooth growth. It is of particular interest to ascertain how different dosage amounts and types of supplements influence tooth growth. First, I will need to load the data set and calculate data descriptives and run some ANOVAs.\n\nLoading the data:\n\n```{r}\ndata(\"ToothGrowth\")\nhead(ToothGrowth)\n```\n\nNeed cell means and variances next.\n\n```{r}\nlibrary(dplyr)\nToothGrowth %>%\ngroup_by(supp, dose)%>%\nsummarize(group_mean = mean(len), n = n(), var = var(len)) \n```\n\n::: text-center\n# **Factorial ANOVA**\n:::\n\nGlancing at these cell means indicates a potential pattern. Namely, that across supplement, as dosage increases, tooth length increases. It also appears that across dosage, the OJ supplement produces longer teeth growth than the VC supplement. However, to determine if these mean differences are significant, I need to conduct a factorial ANOVA.\n\n```{r}\n#Need to ensure that R reads factor variables as factors first\n\nToothGrowth$supp <- as.factor(ToothGrowth$supp)\nToothGrowth$dose <- as.factor(ToothGrowth$dose)\nFactorANOVA <- aov(len ~ dose*supp, ToothGrowth) #you can also just add in dose*supp and R understands to include the interaction and both main effects in the model - nice way to shorten code\n\nsummary(FactorANOVA)\n\n#Calculating Marginal Means\n\nlibrary(emmeans)\n\nCondition_Means <- emmeans(FactorANOVA, ~ supp*dose)\nCondition_Means\n\nMarginal_MeansSupp <- emmeans(FactorANOVA, ~ supp)\nMarginal_MeansSupp\n\nMarginal_MeansDose <- emmeans(FactorANOVA, ~ dose)\nMarginal_MeansDose\n```\n\nA quick glance at the output highlights that both the main effects of dose and supplement are significant as well as their interaction. Across supplement type, the means of tooth length were significantly different among three dosage conditions: 0.5 dosage (M = 10.61), 1.0 dosage (M = 19.74), and 2.0 dosage (M = 26.10), F(2,54) = 92.00, p \\<.001. There was also a statistically significant difference in the average tooth length between supplement type, across dosage: OJ (M = 20.66) and VC condition (M = 16.96), F(1,54) = 15.57, p \\<.001. The interaction between dosage amount and supplement type was significant, F(2,54) = 4.11, p =.02.\n\n::: text-center\n## **Simple Effects**\n:::\n\nGiven the significant interaction, I know that the effects of one variable depends on the levels of the other variable. One way to understand this effect is to look at the simple effects.\n\n```{r}\nlibrary(phia)\n\nlm1 <- lm(len ~ dose*supp, ToothGrowth)\n\nTest1 <- testInteractions(lm1, fixed = \"dose\", across = \"supp\")\nTest1\n\nTest2 <- testInteractions(lm1, fixed = \"supp\", across = \"dose\")\nTest2\n\ncontrast(Condition_Means, \"revpairwise\", by= \"dose\", adjust = \"none\")\n```\n\nNote here the significance levels: for example, the effects of supplement within 0.5 & 1.0 dosage levels are significant. Additionally, the effects of dosage within OJ and VC supplement are also significant. Looking at the contrast estimates, it becomes clear that For both dosage levels of 0.5 and 1.0, teeth grow significantly less when the patient is also provided a vitamin C supplement, compared to the teeth of patients provided an orange juice supplement, t(54) = -3.23, p =.002 and t(54) = -3.65, p \\<.001 respectively.\n\n::: text-center\n## **Effect Sizes**\n:::\n\nNow let's collect both biased and unbiased estimates of effect size for our three effects in this model. This will help clarify the magnitude of effect of both dosage and supplement type.\n\n```{r}\nlibrary(lsr)\nlibrary(effectsize)\n\nEta <- etaSquared(FactorANOVA, type = 2, anova = TRUE)\nEta\n\nomega_squared(FactorANOVA, partial = FALSE, ci = 0.95)\nomega_squared(FactorANOVA, partial = TRUE, ci = 0.95)\n```\n\nThe eta squared value associated with the interaction between dosage and supplement is .03. In other words, the interaction term explains approximately 3% of the variance in tooth length. Its' respective partial eta squared value is .13, indicating that the interaction term explains about 13% of the unique variance in tooth length, accounting for any shared variance with dosage and supplement. The interaction term's omega squared and partial omega squared values are slightly smaller as these effect sizes have been corrected for bias but the interpretation stays the same.\n\n::: text-center\n# **Power Analysis**\n:::\n\nNow, I will calculate power for this analysis.\n\n```{r}\nlibrary(pwr)\n\nf <- sqrt(0.031376 / (1-0.031376))\npwr.anova.test(k = 6, n = 10, f = f, sig.level = .95)\n```\n\nI have about a 98% power level to detect the interaction effect in our data, should the effect truly exist. What about the main effect of supplement?\n\n```{r}\nf <- sqrt(0.05948365 / (1-0.05948365))\npwr.anova.test(k = 2, n = 30, f = f, sig.level = .95)\n```\n\nI have a 99% power level to detect the effect of supplement, should the effect exist.\n\n::: text-center\n# **Visualizations**\n:::\n\nThe client also requested some visualizations, so I will create a bar and line graph of the above group means.\n\n```{r}\nlibrary(ggplot2)\n\nggplot(ToothGrowth, aes(x =as.factor(dose), y = len, fill = as.factor(supp))) + \n  stat_summary(fun='mean',geom='bar', position = \"dodge\") +\n  labs(x = \"Dosage\", y = \"Tooth Length\", fill = \"Supplement Type\", title = \"Figure 1\", subtitle = \"Mean Tooth Length Scores by Dosage and Supplement\")+\n  theme(plot.title = element_text(face = \"bold\"),\n        plot.subtitle = element_text(face = \"italic\")) +\n  scale_fill_manual(values = c(\"#D71920\", \"#002266\"))\n\ninteraction.plot(x.factor = ToothGrowth$dose, #x-axis variable\n                 trace.factor = ToothGrowth$supp, #variable for lines\n                 response = ToothGrowth$len, #y-axis variable\n                 fun = mean, #metric to plot\n                 ylab = \"Tooth Length\",\n                 xlab = \"Dosage\",\n                 col = c(\"pink\", \"blue\"),\n                 lty = 1, #line type\n                 lwd = 2, #line width\n                 trace.label = \"Supplement Type\")\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"output-file":"FactorPower.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","editor":"visual","theme":{"dark":"Superhero"},"title":"Factorial Anova and Power Analysis in R","author":"Matthew Swanson","categories":["Factorial ANOVA","R","Power Analysis","Effect Size","Clinical Trial Data"],"message":false},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}